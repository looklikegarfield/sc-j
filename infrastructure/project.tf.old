###Creating a Project
module "project" {
  source            = "../modules/project"
  project_name       = var.ProjectName
  project_id_prefix  = var.ProjectIDPrefix
  folder_id          = var.FolderID
  billing_account    = var.BillingAccount
  organization       = var.Organization
  businessunit       = var.BusinessUnit
  costcenter         = var.CostCenter
  environment        = var.Environment
  infralocation      = var.InfraLocation
  costcenterlocation = var.CostCenterLocation
  le                 = var.LE
}

output "project_id" {
  description = "Id of the newly created root folder"
  value       = "${module.project.project_id}"
}

output "project_number" {
  value = "${module.project.project_number}"
}

#iam DevopsUser binding
module "project_devopsuser" {
  source     = "../modules/project_iam_member_devops"
  project_id = module.project.project_id
  member     = "group:${var.DevopsUser_Group}"
}

#iam Security Admin binding
module "project_securityadmin" {
  source     = "../modules/project_iam_member_securityadmin"
  project_id = module.project.project_id
  member     = "group:${var.SecurityUser_Group}"
}

#iam Network Admin Role binding
module "project_networkadmin" {
  source     = "git@github.com:ServiceTransition/GCP_Modules.git//project_iam_member_networkadmin"
  project_id = module.project.project_id
  member     = "group:${var.NetworkUser_Group}"
}

##Binding power user account to Devops image access
module "pwuser_binding_devops_images" {
 source     = "../modules/project_iam_member"
  project_id = "${module.project.project_id}"
  role       = "roles/compute.imageUser"
  member     = "group:${var.DevopsUser_Group}"
}

##Binding Google APIs service account to Devops image access
module "googleapi_binding_devops_images" {
  source     = "../modules/project_iam_member"
  project_id = "${module.project.project_id}"
  role       = "roles/compute.imageUser"
  member     = "serviceAccount:${module.project.project_number}@cloudservices.gserviceaccount.com"
}

## enable required project API
module "project_api" {
  source     = "../modules/project_services"
  project_id = "${module.project.project_id}"
}
